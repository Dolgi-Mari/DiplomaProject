{% extends "base.html" %}

{% block body_attributes %}class="{{ body_classes }}"{% endblock %}

{% block content %}

<script> //–¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–¥–∞—á–µ–π —Å—Ç–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ë–î
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∞—Å—Å—ã, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–æ–º, —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    document.body.className = "{{ body_classes }}";
</script>

<!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å, –ø—Ä–∏–ª–∏–ø–∞—é—â–∞—è –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ -->
<div class="sticky-top bg-white border-bottom py-2 mb-3" style="z-index: 100;">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <h5 class="mb-0 me-2">{{ book.title }}</h5>
            <div class="d-flex align-items-center gap-3">
                <!-- –ü–æ–ª–∑—É–Ω–æ–∫ —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞ (—É–∂–µ –µ—Å—Ç—å) -->
                <div class="d-flex align-items-center">
                    <label for="fontSizeRange" class="form-label me-2 mb-0 small">–†–∞–∑–º–µ—Ä</label>
                    <input type="range" class="form-range" id="fontSizeRange" min="0" max="2" step="1" value="1" style="width: 100px;">
                    <span id="fontSizeLabel" class="badge bg-secondary ms-2">–°—Ä–µ–¥–Ω–∏–π</span>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã -->
                <div class="btn-group btn-group-sm" role="group" aria-label="–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è">
                    <button type="button" class="btn btn-outline-secondary theme-btn" data-theme="normal">‚òÄÔ∏è</button>
                    <button type="button" class="btn btn-outline-secondary theme-btn" data-theme="dark">üåô</button>
                    <button type="button" class="btn btn-outline-secondary theme-btn" data-theme="sepia">üìú</button>
                    <button type="button" class="btn btn-outline-secondary theme-btn" data-theme="high">üîÜ</button>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ -->
                <button id="resetSettingsBtn" class="btn btn-outline-danger btn-sm">‚Ü∫ –°–±—Ä–æ—Å</button>

                <a href="/profile/{{ user_id }}" class="btn btn-outline-primary btn-sm">‚Üê –í—ã–π—Ç–∏</a>
            </div>
        </div>
    </div>
</div>

<!-- –¢–µ–∫—Å—Ç –∫–Ω–∏–≥–∏ -->
<div class="container">
    <div id="book-content">
        {{ book_content | safe }}
    </div>
</div>

<script>
    // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
    const body = document.body;
    const slider = document.getElementById('fontSizeRange');
    const label = document.getElementById('fontSizeLabel');
    const themeButtons = document.querySelectorAll('.theme-btn');
    const resetBtn = document.getElementById('resetSettingsBtn');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
    function updateFontSize(value) {
        body.classList.remove('font-small', 'font-medium', 'font-large');
        if (value == 0) {
            body.classList.add('font-small');
            label.textContent = '–ú–∞–ª–µ–Ω—å–∫–∏–π';
        } else if (value == 1) {
            body.classList.add('font-medium');
            label.textContent = '–°—Ä–µ–¥–Ω–∏–π';
        } else if (value == 2) {
            body.classList.add('font-large');
            label.textContent = '–ö—Ä—É–ø–Ω—ã–π';
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–º—ã
    function updateTheme(theme) {
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Ç–µ–º—ã (normal, dark, sepia, high)
        body.classList.remove('theme-normal', 'theme-dark', 'theme-sepia', 'theme-high');
        body.classList.add(`theme-${theme}`);
    }

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–ª–∞–π–¥–µ—Ä–∞ –∏ —Ç–µ–º—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–∫—É—â–∏–º–∏ –∫–ª–∞—Å—Å–∞–º–∏ body
    // –†–∞–∑–º–µ—Ä
    if (body.classList.contains('font-large')) {
        slider.value = 2;
        label.textContent = '–ö—Ä—É–ø–Ω—ã–π';
    } else if (body.classList.contains('font-small')) {
        slider.value = 0;
        label.textContent = '–ú–∞–ª–µ–Ω—å–∫–∏–π';
    } else {
        slider.value = 1; // medium
        label.textContent = '–°—Ä–µ–¥–Ω–∏–π';
    }

    // –¢–µ–º–∞: –æ–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–π –∫–ª–∞—Å—Å —Ç–µ–º—ã –µ—Å—Ç—å
    const currentTheme = Array.from(body.classList).find(cls => cls.startsWith('theme-'));
    if (currentTheme) {
        // currentTheme = 'theme-normal' –∏ —Ç.–¥.
        // –ù–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ, –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Å–≤–µ—Ç–∏–º –ø–æ–∑–∂–µ
    } else {
        // –ï—Å–ª–∏ –∫–ª–∞—Å—Å–∞ —Ç–µ–º—ã –Ω–µ—Ç, —Å—á–∏—Ç–∞–µ–º —Ç–µ–º–æ–π normal –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å
        body.classList.add('theme-normal');
    }

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ —Ç–µ–º—ã
    function highlightActiveTheme() {
        const activeTheme = Array.from(body.classList).find(cls => cls.startsWith('theme-')).replace('theme-', '');
        themeButtons.forEach(btn => {
            if (btn.dataset.theme === activeTheme) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    }

    // –í—ã–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    highlightActiveTheme();

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞
    slider.addEventListener('input', function() {
        updateFontSize(this.value);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ç–µ–º—ã
    themeButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const theme = this.dataset.theme;
            updateTheme(theme);
            highlightActiveTheme();
        });
    });

    // –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Å–ª–∞–ª —Å–µ—Ä–≤–µ—Ä)
    // –î–ª—è —ç—Ç–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–∏–º –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–ª–∞—Å—Å—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const originalClasses = body.className; // —Å—Ç—Ä–æ–∫–∞ –∫–ª–∞—Å—Å–æ–≤

    resetBtn.addEventListener('click', function() {
        body.className = originalClasses; // –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–ª–∞—Å—Å—ã
        // –ü–µ—Ä–µ–Ω–∞—Å—Ç—Ä–æ–∏–º —Å–ª–∞–π–¥–µ—Ä –∏ –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø–æ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã
        // –†–∞–∑–º–µ—Ä
        if (body.classList.contains('font-large')) {
            slider.value = 2;
            label.textContent = '–ö—Ä—É–ø–Ω—ã–π';
        } else if (body.classList.contains('font-small')) {
            slider.value = 0;
            label.textContent = '–ú–∞–ª–µ–Ω—å–∫–∏–π';
        } else {
            slider.value = 1;
            label.textContent = '–°—Ä–µ–¥–Ω–∏–π';
        }
        // –¢–µ–º–∞
        highlightActiveTheme();
    });
</script>

{% endblock %}


